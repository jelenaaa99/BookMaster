var reimePrezime=/^[A-ZŠĐČĆŽ][a-zšđčćž]{2,14}(\s[A-ZŠĐČĆŽ][a-zšđčćž]{2,14})+$/,reEmail=/^[a-z][a-z\d\_\.\-]+\@[a-z]+(\.[a-z]{2,4})+$/,reTelefon=/^06[01234569]\/[\d]{3}\-[\d]{3,4}$/,rePostanskiBroj=/^[0-9]{5}$/,reLozinka=/^[A-z0-9\_\.\-]{6,}$/;function ajaxCallBack(e,t,a){$.ajax({url:e,method:"get",data:{tabela:a},dataType:"json",success:function(e){t(e)},error:function(e){console.log(e)}})}function ispisMeni(e){var t="";for(let a of e)"oNama"==a.href_meni||"knjige"==a.href_meni?t+=`<li><a href="index.php#${a.href_meni}">${a.naziv_meni}</li></a>`:t+=`<li><a href="${a.href_meni}">${a.naziv_meni}</li></a>`;$("#mainMenu").html(t),$("#hamLista").html(t),$("#infoFooter").html(t)}function ispisKnjiga(e){var t="";if(0!=e.length){$("#nemaProizvoda").hide();for(let a of e)t+=`<div class="col-6 col-sm-4 col-md-3 text-center d-flex flex-column justify-content-between py-2">\n                        <div class="prviPrikaz d-flex flex-column justify-content-end">\n                            <div id="slikaKnjige">\n                                <img src="assets/img/${a.src_knjige}" alt="${a.naziv_knjige}" class="w-100"/>\n                            </div>\n                            <p class="p-1 m-0">${a.ime_autor}</p>\n                            <small class="fw-bold p-2">${a.cena_knjige} RSD</small>\n                        </div>\n                        <div class="modalKnjige">\n                            <button type="button" class="btn detaljnijeDugme" data-bs-toggle="modal" data-bs-target="#exampleModal${a.id_knjige}">\n                            Detaljnije\n                            </button>\n    \n                            <div class="modal fade" id="exampleModal${a.id_knjige}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">\n                            <div class="modal-dialog modal-lg">\n                                <div class="modal-content">\n                                <div class="modal-header">\n                                    <h5 class="modal-title fw-bold" id="exampleModalLabel">\n                                        ${a.naziv_knjige}\n                                        <span class="mx-5 text-danger obavestenje">Dodato u korpu!</span>\n                                    </h5>\n                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                                </div>\n                                <div class="modal-body">\n                                    <div class="prviDeoKontejner row">\n                                        <div class="col-12 col-sm-6">\n                                            <div class="slikaModal">\n                                                <img src="assets/img/${a.src_knjige}" alt="${a.naziv_knjige}"/>\n                                            </div>\n                                        </div>\n                                        <div class="col-12 col-sm-6 mt-4 mt-sm-0 text-muted text-start kjigaInfo">\n                                            <p class="fw-bold">${a.naziv_zanr.toUpperCase()}</p>\n                                            <small>Šifra artikla: ${a.sifra_knjige}</small><br/>\n                                            <small>Isbn: ${a.isbn_knjige}</small>\n                                            <p class="m-0 mt-2">Autor: ${a.ime_autor}</p>\n                                            <p class="m-0 mt-2 cena">Cena na sajtu: <span class="fw-bold">${a.cena_knjige} RSD</span></p>\n                                            <button type="button" class="btn btn-danger mt-5 dodaj" data-id="${a.id_knjige}">Dodajte u korpu</button>\n                                        </div>\n                                    </div>\n                                    <div class="row opis">\n                                        <div class="col-12 mt-4">\n                                            <p class="text-muted text-justify">${a.opis_knjige}</p>\n                                        </div>\n                                    </div>\n                                </div>\n                                </div>\n                            </div>\n                            </div>\n                        </div>\n                    </div>`}else $("#nemaProizvoda").show();$("#ispisKnjiga").html(t),$(".dodaj").click(dodajUKorpu),$(".obavestenje").hide()}function filtrirajKnjige(e,t){let a=document.getElementsByClassName("zanr"),n=[];for(let e of a)e.checked&&n.push(e.value);let o=$("#ddlSort").val(),i=$("#pretrazi").val().toLowerCase();dataObjekat={sort:o,pretraga:i},n.length&&(dataObjekat.izbor=n),$.ajax({url:e,method:"get",data:dataObjekat,dataType:"json",success:function(e){t(e)},error:function(e){console.log(e)}})}function provera(e){var t,a,n,o,i,r,s,d,l,m;e.preventDefault(),t=document.getElementById("imePrezime").value.trim(),n=document.getElementById("tel").value.trim(),a=document.getElementById("email").value.trim(),o=document.getElementById("postanskiBroj").value.trim(),i=document.getElementById("tekstPoruke").value.trim(),r=document.getElementById("imeGreska"),s=document.getElementById("emailGreska"),d=document.getElementById("telGreska"),l=document.getElementById("postanskiBrojGreska"),m=document.getElementById("tekstPorukeGreska");var c=0;""==t?(c++,r.innerHTML="Obavezno polje.",r.classList.add("text-danger")):reimePrezime.test(t)?r.innerHTML="":(c++,r.innerHTML="Prvo slovo imena mora biti veliko. Moraju biti upisani i ime i prezime.",r.classList.add("text-danger")),""==n?(c++,d.innerHTML="Obavezno polje.",d.classList.add("text-danger")):reTelefon.test(n)?d.innerHTML="":(c++,d.innerHTML="Format telefona: 06x/xxx-xxx[x]",d.classList.add("text-danger")),""==a?(c++,s.innerHTML="Obavezno polje.",s.classList.add("text-danger")):reEmail.test(a)?s.innerHTML="":(c++,s.innerHTML="Email mora imati karakter @.",s.classList.add("text-danger")),""==o?(c++,l.innerHTML="Obavezno polje.",l.classList.add("text-danger")):!rePostanskiBroj.test(o)||Number(o)<11e3||Number(o>38e3)?(c++,l.innerHTML="Poštanski broj je u opsegu 11000-38000.",l.classList.add("text-danger")):l.innerHTML="",i.length<3?(m.innerHTML="Poruka se sastoji od minimum 3 karaktera.",m.classList.add("text-danger")):m.innerHTML="";let u=t.split(" "),p=u[0],g=u[1];0==c&&($.ajax({url:"models/obrada-forme.php",method:"post",data:{ime:p,prezime:g,tel:n,email:a,posBr:o,por:i,btn:!0},dataType:"json",success:function(e){$("#odgovorServera").html(`<p class="alert alert-success">${e.poruka}</p>`)},error:function(e){console.error(e),422==e.status&&$("#odgovorServera").html('<p class="alert alert-warning">Doslo je do greske prilikom obrade podataka.</p>')}}),document.querySelector("#kontakt > form").reset())}function registracija(e){var t,a,n,o,i,r,s,d,l;e.preventDefault();let m=/^[A-ZŠĐČĆŽ][a-zšđčćž]{2,14}(\s[A-ZŠĐČĆŽ][a-zšđčćž]{2,14})*$/,c=/^([\d\.]{1,3}(\s)?|[a-zšđčćžA-ZŠĐČĆŽ\.]{2,14}(\s)?)+(\s[\d\.]{1,3}|[a-zšđčćžA-ZŠĐČĆŽ\.]{2,14})*$/;var u,p,g,v,j,f,k,b,h;t=document.getElementById("regIme").value.trim(),a=document.getElementById("regPrezime").value.trim(),o=document.getElementById("regTel").value.trim(),n=document.getElementById("regEmail").value.trim(),i=document.getElementById("regPosBr").value.trim(),r=document.getElementById("regGrad").value.trim(),s=document.getElementById("regUlica").value.trim(),d=document.getElementById("regPass").value.trim(),l=$("input[name=rbPol]:checked").val(),u=document.getElementById("imeR"),p=document.getElementById("prezimeR"),g=document.getElementById("emailR"),v=document.getElementById("telR"),j=document.getElementById("posBrojR"),f=document.getElementById("gradR"),k=document.getElementById("ulicaR"),b=document.getElementById("passR"),h=document.getElementById("polR");var L=0;""==t?(L++,u.innerHTML="Obavezno polje.",u.classList.add("text-danger")):m.test(t)?u.innerHTML="":(L++,u.innerHTML="Prvo slovo imena mora biti veliko.",u.classList.add("text-danger")),""==a?(L++,p.innerHTML="Obavezno polje.",p.classList.add("text-danger")):m.test(a)?p.innerHTML="":(L++,p.innerHTML="Prvo slovo prezimena mora biti veliko.",p.classList.add("text-danger")),""==o?(L++,v.innerHTML="Obavezno polje.",v.classList.add("text-danger")):reTelefon.test(o)?v.innerHTML="":(L++,v.innerHTML="Format telefona: 06x/xxx-xxx[x]",v.classList.add("text-danger")),""==n?(L++,g.innerHTML="Obavezno polje.",g.classList.add("text-danger")):reEmail.test(n)?g.innerHTML="":(L++,g.innerHTML="Email mora imati karakter @.",g.classList.add("text-danger")),""==r?(L++,f.innerHTML="Obavezno polje.",f.classList.add("text-danger")):m.test(r)?f.innerHTML="":(L++,f.innerHTML="Grad počinje velikim slovom.",f.classList.add("text-danger")),""==s?(L++,k.innerHTML="Obavezno polje.",k.classList.add("text-danger")):c.test(s)?k.innerHTML="":(L++,k.innerHTML="Ulica može da počne brojem ili slovima.",k.classList.add("text-danger")),""==i?(L++,j.innerHTML="Obavezno polje.",j.classList.add("text-danger")):!rePostanskiBroj.test(i)||Number(i)<11e3||Number(i>38e3)?(L++,j.innerHTML="Poštanski broj je u opsegu 11000-38000.",j.classList.add("text-danger")):j.innerHTML="",""==d?(L++,b.innerHTML="Obavezno polje.",b.classList.add("text-danger")):reLozinka.test(d)?b.innerHTML="":(L++,b.innerHTML="Lozinka se sastoji od slova i brojeva.",b.classList.add("text-danger")),l?h.innerHTML="":(h.innerHTML="Morate izabrati pol",h.classList.add("text-danger")),0==L&&($.ajax({url:"models/registracija.php",method:"post",data:{ime:t,prezime:a,email:n,telefon:o,grad:r,ulica:s,posBr:i,lozinka:d,pol:l,btn:!0},dataType:"json",success:function(e){console.log(e),$("#odgovorServera").html(`<p class="alert alert-success">${e.poruka}</p>`)},error:function(e){console.error(e),422==e.status&&$("#odgovorServera").html('<p class="alert alert-warning">Doslo je do greske prilikom obrade podataka</p>')}}),document.querySelector("#registracija > form").reset())}function logovanje(e){e.preventDefault();let t=$("#logEmail").val(),a=$("#logPass").val(),n=document.getElementById("emailL"),o=document.getElementById("passL"),i=0;""==t?(i++,n.innerHTML="Obavezno polje.",n.classList.add("text-danger")):reEmail.test(t)?n.innerHTML="":(i++,n.innerHTML="Email mora imati karakter @.",n.classList.add("text-danger")),""==a?(i++,o.innerHTML="Obavezno polje.",o.classList.add("text-danger")):reLozinka.test(a)?o.innerHTML="":(i++,o.innerHTML="Lozinka se sastoji od slova i brojeva.",o.classList.add("text-danger")),0==i&&$.ajax({url:"models/logovanje.php",method:"post",data:{email:t,lozinka:a,btn:!0},dataType:"json",success:function(e){console.log(e),window.location.reload()},error:function(e){console.error(e),422==e.status&&$("#odgovorServera2").html('<p class="alert alert-warning">Doslo je do greske prilikom obrade podataka.</p>'),401==e.status&&$("#odgovorServera2").html('<p class="alert alert-warning">Proverite ispravnost email-a i lozinke.</p>'),403==e.status&&$("#odgovorServera2").html('<p class="alert alert-warning">Morate se odjaviti da biste se prijavili sa drugim nalogom.</p>')}})}function setItemLS(e,t){return localStorage.setItem(e,JSON.stringify(t))}function getItemLS(e){return JSON.parse(localStorage.getItem(e))}function dodajUKorpu(){let e=$(this).data("id"),t=getItemLS("cart");$(".obavestenje").fadeIn(700,function(){$(this).fadeOut(2e3)}),t?istiProizvod(e)?(povecajKolicinu(e),stampajBrojProizvodaKorpe()):(dodajDrugiProizvod(e),stampajBrojProizvodaKorpe()):(dodajPrviProizvod(e),stampajBrojProizvodaKorpe())}function dodajPrviProizvod(e){let t=[];t[0]={id:e,quantity:1},setItemLS("cart",t)}function dodajDrugiProizvod(e){let t=getItemLS("cart");t.push({id:e,quantity:1}),setItemLS("cart",t)}function istiProizvod(e){return getItemLS("cart").filter(t=>t.id==e).length}function povecajKolicinu(e){let t=getItemLS("cart");for(let a of t)a.id==e&&a.quantity++;setItemLS("cart",t)}function stampajBrojProizvodaKorpe(){let e=getItemLS("cart"),t=0;if(null!=e)for(let a of e)t+=a.quantity;else t=0;$(".korpa div").html(t)}function ispisKorpe(e){let t=0,a='<table class="table table-hover">\n                    <thead>\n                    <th></th>\n                    <th>Proizvod</th>\n                    <th>Cena</th>\n                    <th>Količina</th>\n                    <th>Ukupno</th>\n                </thead>',n=getItemLS("cart");for(let o of e)for(let e of n)o.id_knjige==e.id&&(a+=`<tbody>\n                    <tr>\n                        <td>\n                            <img src="assets/img/${o.src_knjige}" alt="${o.naziv_knjige}" class="img-fluid slikaUKorpi d-none d-sm-block"/>\n                        </td>\n                        <td>\n                            <p class="text-muted fw-bold">${o.naziv_zanr}</p>\n                            <p class="fw-bold">${o.naziv_knjige}</p>\n                            <p class="text-muted">Šifra artikla: ${o.sifra_knjige}</p>\n                        </td>\n                        <td class="text-muted">${o.cena_knjige} RSD</td>\n                        <td class="text-muted">${e.quantity}</td>\n                        <td class="text-muted">\n                            <p>${e.quantity*Number(o.cena_knjige)} RSD</p>\n                            <p><a href="#" class="obrisiIkonica" data-idproizvoda="${e.id}"><i class="fa fa-trash-o" aria-hidden="true"></i></a></p>\n                        </td>\n                    </tr>`,t+=e.quantity*Number(o.cena_knjige));a+=`</tbody></table><p class="fw-bold text-end">Ukupno: ${t} RSD</p>`,$("#ispisProizvodaUKorpi").html(a),$("#ukupanIznosModal").val(t+" RSD")}function obrisiPojedinacanProizvodIzKorpe(){let e=$(this).data("idproizvoda");setItemLS("cart",getItemLS("cart").filter(t=>t.id!=e)),window.location.reload()}function izvuciId(){let e=getItemLS("cart"),t=[];if(e)for(let a of e)t.push(a.id);return t}function zavrsiKupovinu(){let e=$("#regUlica").val(),t=$("#regPosBr").val(),a=$("#regGrad").val();$.ajax({url:"models/zavrsi-kupovinu.php",method:"post",data:{korpa:localStorage.getItem("cart"),grad:a,pb:t,adresa:e},dataType:"json",success:function(e){console.log(e),e.success&&(localStorage.removeItem("cart"),$("#korpa h4").html("Vaša korpa je prazna."),$("#btnDovrsi, #ispisProizvodaUKorpi, #upozorenje, .modal-footer").hide(),$(".modal-body").html(`<p class="text-success fw-bold fs-4"><i class="fa fa-check-circle-o mx-1" aria-hidden="true"></i>${e.response}</p>`),$(".brProizvoda").html("0"),setTimeout(function(){location.reload()},2e3))},error:function(e){console.log(e)}})}function pitanjaOdgovori(e){let t="";for(let a of e)t+=`<div class="fs-5 red" data-id="${a.id_pitanja}">\n                    <div class="d-flex justify-content-between">\n                        <p>${a.pitanje}</p>\n                        <div class="strelica"><i class="fa fa-chevron-up" aria-hidden="true"></i></div>\n                    </div>\n                    <div>\n                        <p class="${a.id_pitanja} odgovor fs-6">${a.odgovor}</p>\n                    </div>\n                </div>`;$(document).ready(function(){$(".odgovor").hide(),$(".red").click(function(){let e=$(this).data("id");"fa fa-chevron-down"==$(`[data-id=${e}] .strelica i`).attr("class")?($(`[data-id=${e}] .strelica i`).removeClass("fa fa-chevron-down"),$(`[data-id=${e}] .strelica i`).addClass("fa fa-chevron-up")):($(`[data-id=${e}] .strelica i`).removeClass("fa fa-chevron-up"),$(`[data-id=${e}] .strelica i`).addClass("fa fa-chevron-down")),$(`.${e}`).slideToggle()})}),$("#pitanjaOdgovori").html(t)}window.onload=(()=>{if($("#hamLista").hide(),document.getElementById("ham").addEventListener("click",function(){var e=document.getElementById("ham").classList;for(let t=0;t<e.length;t++){if("fa-bars"==e[t]){document.getElementById("ham").classList.remove("fa-bars"),document.getElementById("ham").classList.add("fa-times");break}if("fa-times"==e[t]){document.getElementById("ham").classList.remove("fa-times"),document.getElementById("ham").classList.add("fa-bars");break}}$("#hamLista").slideToggle()}),(document.getElementById("index")||document.getElementById("kontakt")||document.getElementById("registracija")||document.getElementById("logovanje")||document.getElementById("korpa")||document.getElementById("admin")||document.getElementById("izmeni")||document.getElementById("poruke")||document.getElementById("narudzbine")||document.getElementById("pomoc")||document.getElementById("autor"))&&(ajaxCallBack("models/dohvatanjeTabela.php",ispisMeni,"meni"),stampajBrojProizvodaKorpe()),document.getElementById("index")&&(ajaxCallBack("models/dohvatanjeTabela.php",ispisKnjiga,"knjige"),$("#zanrovi, #ddlSort, #pretrazi").on("change keyup",function(){filtrirajKnjige("models/filtriranjeZanra.php",ispisKnjiga)})),document.getElementById("kontakt")&&$("#btnPosalji").click(function(e){provera(e)}),document.getElementById("registracija")&&$("#btnReg").click(function(e){registracija(e)}),document.getElementById("logovanje")&&$("#btnPrijava").click(function(e){logovanje(e)}),(document.getElementById("registracija")||document.getElementById("logovanje")||document.getElementById("izmeni"))&&($("#btnReg").click(function(e){registracija(e)}),$(".prikaziPass").click(function(){let e=$("#regPass"),t=$("#logPass"),a=$("#izmeniPass");"password"==e.attr("type")?e.attr("type","text"):e.attr("type","password"),"password"==t.attr("type")?t.attr("type","text"):t.attr("type","password"),"password"==a.attr("type")?a.attr("type","text"):a.attr("type","password")})),document.getElementById("korpa")){let e=getItemLS("cart");e&&0!=e.length?($("#korpa h4").html("Vaša korpa"),$("#btnDovrsi").show(),$("#upozorenje").show(),$("#zavrsi").click(zavrsiKupovinu)):($("#korpa h4").html("Vaša korpa je prazna."),$("#btnDovrsi").hide(),$("#upozorenje").hide()),$(document).on("click",".obrisiIkonica",obrisiPojedinacanProizvodIzKorpe),idProizvoda=izvuciId(),$.ajax({url:"models/proizvodi-u-korpi.php",method:"get",dataType:"json",data:{id:idProizvoda},success:function(e){ispisKorpe(e)},error:function(e){console.log(e)}})}document.getElementById("pomoc")&&ajaxCallBack("models/dohvatanjeTabela.php",pitanjaOdgovori,"najcesca_pitanja_i_odgovori")});